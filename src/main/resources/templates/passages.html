<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Passages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <script src="/getrequest.js"></script>
    <script src="/postrequest.js"></script>
    <script src="/passage.js"></script>

</head>

<style>
    .save-icon{
        cursor: pointer;
    }
</style>
<body>
<div class="container">
    <h2>Passage Management</h2>

    <button id="getPassagesByDate" type="button" class="btn btn-secondary">Afficher les passages</button>
    <input type="text" id="dateBilan" list="datesList" placeholder="Sélectionner une date">

    <datalist id="datesList"></datalist>

    <table border="1px" class="table table-striped mt-3">
        <thead>
        <tr>
            <th scope="col">INTITULES</th>
            <th scope="col">MONTANT (+)</th>
            <th scope="col">MONTANT (-)</th>
            <th scope="col"></th>
        </tr>
        </thead>
        <tbody id="getResultDiv">
        <tr>
            <th>I. RESULTAT NET COMPTABLE</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr  th:each="passage : ${part1}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>II. REINTEGRATIONS FISCALES</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part2}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>III. DEDUCTIONS FISCALES</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part3}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>TOTAL</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr></tr>

        <tr>
            <th>IV. RESULTAT BRUT FISCAL</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part4}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>V. REPORTS DEFICITAIRES IMPUTES (C) (1)</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part5}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>VI. RESULTAT NET FISCAL</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part6}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>VII. CUMUL DES AMORTISSEMENTS FISCALEMENT DIFFERES</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part7}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        <tr>
            <th>VIII. CUMUL DES DEFICITS FISCAUX RESTANT A REPORTER</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>

        <tr  th:each="passage : ${part8}">
            <td data-field-name='name' th:text="${passage.name}"></td>
            <td style='cursor:pointer;' data-field-name='amountPlus' class='editable-field' th:text="${passage.amountPlus}"></td>
            <td style='cursor:pointer;' data-field-name='amountMinus' class='editable-field' th:text="${passage.amountMinus}"></td>
            <td><i class="fa-regular fa-pen-to-square save-icon"></i></td>
        </tr>

        </tbody>
    </table>
</div>

<!-- Ajoutez une boîte de dialogue modale pour la saisie de la date -->
<div class="modal fade" id="dateModal" tabindex="-1" role="dialog" aria-labelledby="dateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dateModalLabel">Sélectionnez la date</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="date" id="inputDate" class="form-control" min="2000-01-01" max="2025-12-31" step="1">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-primary" id="confirmDate">Confirmer</button>
            </div>
        </div>
    </div>
</div>

</body>

<script>
    // Fonction pour générer les options du datalist avec les dates du 31 décembre
    function generateDatesList() {
        var datalist = document.getElementById("datesList");
        for (var year = 2000; year <= 2025; year++) {
            var option = document.createElement("option");
            // Formatage de la date au format DD/MM/AAAA
            var formattedDate = "31/12/" + year;
            option.value = formattedDate;
            datalist.appendChild(option);
        }
    }

    // Appel de la fonction au chargement de la page
    window.onload = generateDatesList;

    // Fonction pour ouvrir le modal au chargement de la page
    $(document).ready(function() {
        // Ouvrir le modal
        $('#dateModal').modal('show');
    });

</script>

</html>